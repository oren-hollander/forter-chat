{"version":3,"file":"chat-controller.js","sourceRoot":"","sources":["src/chat-controller.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,WAAW,EAAE,MAAM,eAAe,CAAA;AAE3C,MAAM,OAAO,cAAc;IAMzB,YAAY,IAA4B;QAFxC,aAAQ,GAAiB,EAAE,CAAA;QAGzB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;QAChB,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA;IAC/B,CAAC;IAED,KAAK,CAAC,aAAa;QACjB,MAAM,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAA;QAC5D,MAAM,gBAAgB,GAAG,MAAM,WAAW,CAAC,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,GAAG,KAAI,CAAC,CAAC,CAAA;QAC7D,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,EAAE,GAAG,gBAAgB,CAAC,CAAC,CAAA;QACvF,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAA;IAC3B,CAAC;IAED,0BAA0B;IAC1B,iDAAiD;IACjD,iBAAiB;IACjB,8BAA8B;IAC9B,IAAI;IAEJ,aAAa;QACX,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,WAAW,CAAC,KAAK,IAAI,EAAE;YAC3C,MAAM,IAAI,CAAC,aAAa,EAAE,CAAA;QAC5B,CAAC,EAAE,IAAI,CAAC,CAAA;IACV,CAAC;IAED,gBAAgB;QACd,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QAC3B,IAAI,CAAC,OAAO,GAAG,SAAS,CAAA;IAC1B,CAAC;CACF","sourcesContent":["import { ReactiveController, ReactiveControllerHost } from 'lit'\nimport { MessageDTO } from './api'\nimport { getMessages } from './chatService'\n\nexport class ChatController implements ReactiveController {\n  private timerId?: number\n  private host: ReactiveControllerHost\n\n  messages: MessageDTO[] = []\n\n  constructor(host: ReactiveControllerHost) {\n    this.host = host\n    this.host.addController(this)\n  }\n\n  async fetchMessages() {\n    const lastSeq = maxBy(message => message.seq, this.messages)\n    const incomingMessages = await getMessages(lastSeq?.seq || 0)\n    this.messages = uniqBy(message => message.seq, [...this.messages, ...incomingMessages])\n    this.host.requestUpdate()\n  }\n\n  // async fetchMessages() {\n  //   this.messages.push(`Message #${this.count}`)\n  //   this.count++\n  //   this.host.requestUpdate()\n  // }\n\n  hostConnected() {\n    this.timerId = window.setInterval(async () => {\n      await this.fetchMessages()\n    }, 1000)\n  }\n\n  hostDisconnected() {\n    clearInterval(this.timerId)\n    this.timerId = undefined\n  }\n}\n"]}